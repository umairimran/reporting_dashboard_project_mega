# **DATABASE SCHEMA SPECIFICATION**

### ***Paid Media Performance Dashboard (V1)***

# **1\. Overview**

This schema supports:

* Daily S3 data ingestion  
* Historical record storage  
* CPM-based derived metric calculations  
* Multi-level performance breakdowns  
* User authentication  
* Client management  
* Weekly & monthly summaries  
* Ingestion logging  
* Admin portal features

All tables use **PostgreSQL** conventions.

Foreign keys use **ON UPDATE CASCADE**, **ON DELETE RESTRICT** unless defined otherwise.

# **2\. Entity Relationship Diagram (Text Summary)**

`users (admin + clients)`  
     `│ 1`  
     `│`  
     `├───< clients`  
               `│ 1`  
               `│`  
               `├───< client_settings (CPM values)`  
               `│`  
               `├───< campaigns`  
               `│         │`  
               `│         ├───< strategies`  
               `│                   │`  
               `│                   ├───< placements`  
               `│                   │        │`  
               `│                   │        └───< creatives`  
               `│                   │`  
               `│                   └───< daily_metrics`  
               `│`  
               `├───< weekly_summaries`  
               `└───< monthly_summaries`

 `ingestion_logs (standalone)`  
 `staging_media_raw (standalone for ingestion pipeline)`

# **3\. TABLE DEFINITIONS**

Below is each table, its columns, data types, defaults, indexes, and notes.

# **3.1 users**

Stores authenticated users (admin and clients).

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK | Primary key |
| email | VARCHAR(255) | Unique |
| password\_hash | TEXT | Bcrypt/argon2 |
| role | VARCHAR(20) | 'admin' or 'client' |
| created\_at | TIMESTAMP | Default NOW() |
| updated\_at | TIMESTAMP | Auto-update |

**Indexes:**

* `idx_users_email_unique`

# **3.2 clients**

One record per client company.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| name | VARCHAR(255) | Display name |
| status | VARCHAR(20) | 'active' or 'disabled' |
| created\_at | TIMESTAMP |  |
| updated\_at | TIMESTAMP |  |

**Indexes:**

* `idx_clients_name`

# **3.3 client\_settings**

Stores CPM and other client-specific configuration.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| client\_id | UUID FK | → clients.id |
| cpm | DECIMAL(10,4) | Client CPM rate |
| effective\_date | DATE | Optional |
| created\_at | TIMESTAMP |  |
| updated\_at | TIMESTAMP |  |

**Indexes:**

* `idx_client_settings_client_id`

# **3.4 campaigns**

Campaigns are unique per client.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| client\_id | UUID FK | → clients.id |
| name | VARCHAR(255) | Campaign name |
| created\_at | TIMESTAMP |  |
| updated\_at | TIMESTAMP |  |

**Indexes:**

* `idx_campaign_client_name` (client\_id \+ name unique)

# **3.5 strategies**

Each strategy belongs to a campaign.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| campaign\_id | UUID FK | → campaigns.id |
| name | VARCHAR(255) | Strategy name |
| created\_at | TIMESTAMP |  |
| updated\_at | TIMESTAMP |  |

**Indexes:**

* `idx_strategy_campaign_name` (campaign\_id \+ name unique)

# **3.6 placements**

Placement belongs to a strategy.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| strategy\_id | UUID FK | → strategies.id |
| name | VARCHAR(255) | Placement name |
| created\_at | TIMESTAMP |  |
| updated\_at | TIMESTAMP |  |

# **3.7 creatives**

Creative-level items belong to a placement.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| placement\_id | UUID FK | → placements.id |
| name | VARCHAR(255) | Creative name |
| preview\_url | TEXT | Optional (phase 2+ if provided by partner) |
| created\_at | TIMESTAMP |  |
| updated\_at | TIMESTAMP |  |

# **3.8 daily\_metrics**

Stores processed data with CPM-adjusted spend and derived metrics.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| client\_id | UUID FK | → clients.id |
| date | DATE | Reporting date |
| campaign\_id | UUID FK |  |
| strategy\_id | UUID FK |  |
| placement\_id | UUID FK |  |
| creative\_id | UUID FK |  |
| impressions | BIGINT |  |
| clicks | BIGINT |  |
| ctr | DECIMAL(12,6) | CTR |
| conversions | BIGINT |  |
| conversion\_revenue | DECIMAL(12,2) |  |
| spend | DECIMAL(12,2) | CPM-adjusted spend |
| cpc | DECIMAL(12,4) | Derived |
| cpa | DECIMAL(12,4) | Derived |
| roas | DECIMAL(12,4) | Derived |
| created\_at | TIMESTAMP |  |
| updated\_at | TIMESTAMP |  |

**Indexes:**

* `idx_metrics_client_date`

* `idx_metrics_campaign`

* `idx_metrics_strategy`

* `idx_metrics_placement`

* `idx_metrics_creative`

# **3.9 weekly\_summaries**

Aggregated weekly performance results.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| client\_id | UUID FK |  |
| week\_start | DATE | Monday |
| week\_end | DATE | Sunday |
| impressions | BIGINT |  |
| clicks | BIGINT |  |
| conversions | BIGINT |  |
| revenue | DECIMAL(12,2) |  |
| spend | DECIMAL(12,2) |  |
| ctr | DECIMAL(12,6) |  |
| cpc | DECIMAL(12,4) |  |
| cpa | DECIMAL(12,4) |  |
| roas | DECIMAL(12,4) |  |
| top\_campaigns | JSONB | Array of ranked items |
| top\_creatives | JSONB | Array of ranked items |
| created\_at | TIMESTAMP |  |

# **3.10 monthly\_summaries**

Similar to weekly, for calendar months.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| client\_id | UUID FK |  |
| month\_start | DATE |  |
| month\_end | DATE |  |
| impressions | BIGINT |  |
| clicks | BIGINT |  |
| conversions | BIGINT |  |
| revenue | DECIMAL(12,2) |  |
| spend | DECIMAL(12,2) |  |
| ctr | DECIMAL(12,6) |  |
| cpc | DECIMAL(12,4) |  |
| cpa | DECIMAL(12,4) |  |
| roas | DECIMAL(12,4) |  |
| top\_campaigns | JSONB |  |
| top\_creatives | JSONB |  |
| created\_at | TIMESTAMP |  |

# **3.11 staging\_media\_raw**

Used during ingestion.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| ingestion\_run\_id | UUID | Links to ingestion\_logs |
| client\_id | UUID FK |  |
| date | DATE |  |
| campaign\_name | VARCHAR(255) |  |
| strategy\_name | VARCHAR(255) |  |
| placement\_name | VARCHAR(255) |  |
| creative\_name | VARCHAR(255) |  |
| impressions | BIGINT |  |
| clicks | BIGINT |  |
| ctr | DECIMAL(12,6) |  |
| conversions | BIGINT |  |
| conversion\_revenue | DECIMAL(12,2) |  |
| created\_at | TIMESTAMP |  |

# **3.12 ingestion\_logs**

Tracks every ingestion attempt.

| Column | Type | Notes |
| ----- | ----- | ----- |
| id | UUID PK |  |
| run\_date | DATE | Date of the file ingested |
| status | VARCHAR(20) | 'success' or 'failed' |
| message | TEXT | Error or success message |
| records\_loaded | INT | Number of rows parsed |
| records\_failed | INT | Number of rows rejected |
| started\_at | TIMESTAMP |  |
| finished\_at | TIMESTAMP |  |
| file\_name | VARCHAR(255) |  |
| created\_at | TIMESTAMP | Default NOW() |

# **4\. Index Strategy**

We apply indexing in 3 areas:

1. **Query speed** (dashboards filter by date, client, campaign)  
2. **Ingestion speed**  
3. **Weekly/monthly summary generation**

Important indexes include:

* `idx_metrics_client_date` (PRIMARY for dashboard speed)  
* `idx_campaign_client_name`  
* `idx_strategy_campaign_name`  
* `idx_users_email_unique`

# **5\. Row-Level Security (Optional but recommended)**

To ensure clients only see their own data:

Enable PostgreSQL RLS on:

* daily\_metrics  
* weekly\_summaries  
* monthly\_summaries  
* campaigns, strategies, placements, creatives

Policy:

`client_id = (SELECT client_id FROM users WHERE id = current_user_id)`

# **6\. Future Expandability**

The schema is intentionally built to support:

* Adding new channels (SEO, GA4, CRM)  
* Adding new metrics  
* Multiple media partners  
* Seasonal pacing models  
* Client white-labeling  
* Role-based permissions  
* Multi-user login per client

